<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-getting-started/grendel-deployment" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">6. Grendel Deployment | ClusterFactory</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.clusterfactory.io/docs/getting-started/grendel-deployment"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="6. Grendel Deployment | ClusterFactory"><meta data-rh="true" name="description" content="The argo/provisioning directory deploys the Grendel application. Grendel is a PXE, TFTP and DHCP server used for network booting. It&#x27;s lightweight and written in Go."><meta data-rh="true" property="og:description" content="The argo/provisioning directory deploys the Grendel application. Grendel is a PXE, TFTP and DHCP server used for network booting. It&#x27;s lightweight and written in Go."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.clusterfactory.io/docs/getting-started/grendel-deployment"><link data-rh="true" rel="alternate" href="https://docs.clusterfactory.io/docs/getting-started/grendel-deployment" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.clusterfactory.io/docs/getting-started/grendel-deployment" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://LV046ZHO1F-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"6. Grendel Deployment","item":"https://docs.clusterfactory.io/docs/getting-started/grendel-deployment"}]}</script><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ML4FLDLN4Z"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ML4FLDLN4Z",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="ClusterFactory" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.e7495e17.css">
<script src="/assets/js/runtime~main.a2fd81cd.js" defer="defer"></script>
<script src="/assets/js/main.d4d0a8e8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><link rel="preload" as="image" href="/img/deepsquare-logo-h.svg"><link rel="preload" as="image" href="/img/deepsquare-logo-h-neg.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_XsJ2" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="ClusterFactory Logo" class="themedComponent_mogz themedComponent--light_jBMB"><img src="/img/logo.svg" alt="ClusterFactory Logo" class="themedComponent_mogz themedComponent--dark_puEI"></div><b class="navbar__title text--truncate">ClusterFactory Docs</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/deepsquare-io/ClusterFactory" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_pe4Y"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_qBMu colorModeToggle_oYDm"><button class="clean-btn toggleButton_X7Fq toggleButtonDisabled_XGl_" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_y93W lightToggleIcon_HRSM"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_y93W darkToggleIcon_qa_C"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_y93W systemToggleIcon_TOS2"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_fKJZ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_ycLg"><div class="docsWrapper_sVBF"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_aLZN" type="button"></button><div class="docRoot_AJyq"><aside class="theme-doc-sidebar-container docSidebarContainer_Sove"><div class="sidebarViewport_mNnF"><div class="sidebar_PFAq"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_xl2m"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/overview/welcome"><span title="Overview" class="categoryLinkLabel_l3MX">Overview</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/overview/welcome"><span title="Welcome to the ClusterFactory Documentation" class="linkLabel_vVD8">Welcome to the ClusterFactory Documentation</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/getting-started/overview"><span title="Getting Started" class="categoryLinkLabel_l3MX">Getting Started</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/overview"><span title="Overview" class="linkLabel_vVD8">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/requirements-recommendations"><span title="1. Requirements and recommendations" class="linkLabel_vVD8">1. Requirements and recommendations</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/setting-up-repository"><span title="2. Setting up your repository for GitOps" class="linkLabel_vVD8">2. Setting up your repository for GitOps</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/k0s-configuration"><span title="3. K0s Configuration" class="linkLabel_vVD8">3. K0s Configuration</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/core-apps-deployment"><span title="4. Core Apps Deployment" class="linkLabel_vVD8">4. Core Apps Deployment</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started/adding-repository-argocd"><span title="5. Adding the Git repository to ArgoCD" class="linkLabel_vVD8">5. Adding the Git repository to ArgoCD</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/getting-started/grendel-deployment"><span title="6. Grendel Deployment" class="linkLabel_vVD8">6. Grendel Deployment</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/main-concepts/k0s"><span title="Main Concepts" class="categoryLinkLabel_l3MX">Main Concepts</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/k0s"><span title="K0s, the Kubernetes distribution for bare-metal" class="linkLabel_vVD8">K0s, the Kubernetes distribution for bare-metal</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/main-concepts/core-network/metallb"><span title="Core Network" class="categoryLinkLabel_l3MX">Core Network</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/core-network/metallb"><span title="MetalLB, the bare-metal Load Balancer" class="linkLabel_vVD8">MetalLB, the bare-metal Load Balancer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/core-network/traefik"><span title="Traefik, the All-in-One L7 Load Balancer and Ingress" class="linkLabel_vVD8">Traefik, the All-in-One L7 Load Balancer and Ingress</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/core-network/multus-cni"><span title="Multus CNI, the Swiss army knife of networking" class="linkLabel_vVD8">Multus CNI, the Swiss army knife of networking</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/main-concepts/gitops/argocd"><span title="GitOps" class="categoryLinkLabel_l3MX">GitOps</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/gitops/argocd"><span title="Argo CD, GitOps for Kubernetes" class="linkLabel_vVD8">Argo CD, GitOps for Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/gitops/cert-manager"><span title="cert-manager, the Certificate Manager" class="linkLabel_vVD8">cert-manager, the Certificate Manager</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/gitops/sealed-secrets"><span title="Sealed Secrets, the Secret Manager for Kubernetes" class="linkLabel_vVD8">Sealed Secrets, the Secret Manager for Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/gitops/stateless-os"><span title="dmsquash-live and SystemD, GitOps for compute nodes" class="linkLabel_vVD8">dmsquash-live and SystemD, GitOps for compute nodes</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/main-concepts/apps/grendel"><span title="Main Applications" class="categoryLinkLabel_l3MX">Main Applications</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/apps/grendel"><span title="Grendel, the Bare-Metal Provisioner" class="linkLabel_vVD8">Grendel, the Bare-Metal Provisioner</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/apps/slurm"><span title="SLURM, A Highly Scalable Workload Manager" class="linkLabel_vVD8">SLURM, A Highly Scalable Workload Manager</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/main-concepts/apps/cvmfs"><span title="CernVM-FS, A Scalable, Distributed Read-Only File-System" class="linkLabel_vVD8">CernVM-FS, A Scalable, Distributed Read-Only File-System</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/guides/exposing-k8s-workloads"><span title="Guides" class="categoryLinkLabel_l3MX">Guides</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/exposing-k8s-workloads"><span title="Exposing your Kubernetes Workload" class="linkLabel_vVD8">Exposing your Kubernetes Workload</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/guides/maintenance/high-availability"><span title="Maintenance" class="categoryLinkLabel_l3MX">Maintenance</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/maintenance/high-availability"><span title="Creating a highly available cluster" class="linkLabel_vVD8">Creating a highly available cluster</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/maintenance/updating-k0s-cluster"><span title="Updating the K0s cluster" class="linkLabel_vVD8">Updating the K0s cluster</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/maintenance/backup-restore"><span title="Backup and restore" class="linkLabel_vVD8">Backup and restore</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/maintenance/removing-controller"><span title="Ejecting a controller" class="linkLabel_vVD8">Ejecting a controller</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/guides/monitoring/deploy"><span title="Monitoring" class="categoryLinkLabel_l3MX">Monitoring</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/monitoring/deploy"><span title="Deploy the Kube Prometheus Stack" class="linkLabel_vVD8">Deploy the Kube Prometheus Stack</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/monitoring/service-monitor"><span title="Using ServiceMonitor to fetch metrics" class="linkLabel_vVD8">Using ServiceMonitor to fetch metrics</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/guides/provisioning/packer-build"><span title="Provisioning" class="categoryLinkLabel_l3MX">Provisioning</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/provisioning/packer-build"><span title="Build an OS Image with Packer" class="linkLabel_vVD8">Build an OS Image with Packer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/provisioning/gitops-with-grendel"><span title="GitOps with Grendel" class="linkLabel_vVD8">GitOps with Grendel</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/guides/slurm/deploy-slurm"><span title="SLURM Stack" class="categoryLinkLabel_l3MX">SLURM Stack</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/slurm/deploy-slurm"><span title="Deploying SLURM Cluster" class="linkLabel_vVD8">Deploying SLURM Cluster</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/slurm/deploy-ondemand"><span title="Deploy Open OnDemand" class="linkLabel_vVD8">Deploy Open OnDemand</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/guides/cvmfs/mount-cvmfs"><span title="CVMFS Stack" class="categoryLinkLabel_l3MX">CVMFS Stack</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/cvmfs/mount-cvmfs"><span title="Mount CVMFS repositories on Kubernetes" class="linkLabel_vVD8">Mount CVMFS repositories on Kubernetes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/cvmfs/deploy-cvmfs"><span title="Deploy a CVMFS Stratum 1" class="linkLabel_vVD8">Deploy a CVMFS Stratum 1</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/guides/kubevirt/deploy-vm"><span title="VM Workloads" class="categoryLinkLabel_l3MX">VM Workloads</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/kubevirt/deploy-vm"><span title="Deploy a VM with KubeVirt" class="linkLabel_vVD8">Deploy a VM with KubeVirt</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" tabindex="0" href="/docs/guides/storage/overview"><span title="Deploying Storage Plane" class="categoryLinkLabel_l3MX">Deploying Storage Plane</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/storage/overview"><span title="Overview" class="linkLabel_vVD8">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/storage/storage-architecture"><span title="Storage Architecture" class="linkLabel_vVD8">Storage Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/storage/deploying-rook"><span title="Deploying the Rook Operator" class="linkLabel_vVD8">Deploying the Rook Operator</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/storage/deploying-rook-cluster"><span title="Deploying a Rook Cluster" class="linkLabel_vVD8">Deploying a Rook Cluster</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/storage/claiming-volume"><span title="Claiming a volume" class="linkLabel_vVD8">Claiming a volume</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/deploy-ldap"><span title="Deploy a LDAP server" class="linkLabel_vVD8">Deploy a LDAP server</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/reference/cfctl"><span title="Reference" class="categoryLinkLabel_l3MX">Reference</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cfctl"><span title="cfctl" class="linkLabel_vVD8">cfctl</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reference/cfctl.yaml"><span title="cfctl.yaml" class="linkLabel_vVD8">cfctl.yaml</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_NgnL menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/see-also/contributing"><span title="See Also" class="categoryLinkLabel_l3MX">See Also</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/see-also/contributing"><span title="Contributing" class="linkLabel_vVD8">Contributing</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/see-also/faq"><span title="Frequently Asked Questions" class="linkLabel_vVD8">Frequently Asked Questions</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_QTOB"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_Ylyo"><div class="docItemContainer_EI79"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_YkNE" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_qODI"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Getting Started</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">6. Grendel Deployment</span></li></ul></nav><div class="tocCollapsible_WH0l theme-doc-toc-mobile tocMobile_UM7C"><button type="button" class="clean-btn tocCollapsibleButton_NWoy">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>6. Grendel Deployment</h1></header>
<p>The <code>argo/provisioning</code> directory deploys the Grendel application. Grendel is a PXE, TFTP and DHCP server used for network booting. It&#x27;s lightweight and written in Go.</p>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="1-namespace-and-appproject">1. Namespace and AppProject<a href="#1-namespace-and-appproject" class="hash-link" aria-label="Direct link to 1. Namespace and AppProject" title="Direct link to 1. Namespace and AppProject" translate="no">​</a></h2>
<p>Create the Kubernetes namespace and ArgoCD AppProject.</p>
<div class="language-shell codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">user@local:/ClusterFactory</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-shell codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> argo/provisioning</span><br></span></code></pre></div></div>
<p>Kubernetes&#x27; namespaces are used to isolate workloads and organize the Kubernetes cluster application.</p>
<p>ArgoCD&#x27;s AppProjects are used in the continuous deployment process to prevent unauthorized deployment of resources. The more restrictive this is, the better we can avoid a supply chain attack.</p>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="2-preparing-the-dynamic-provisioning-of-volumes">2. Preparing the dynamic provisioning of volumes<a href="#2-preparing-the-dynamic-provisioning-of-volumes" class="hash-link" aria-label="Direct link to 2. Preparing the dynamic provisioning of volumes" title="Direct link to 2. Preparing the dynamic provisioning of volumes" translate="no">​</a></h2>
<p>Grendel needs to store its OS images. We will use NFS for the storage in this guide, but there are other solution like OpenEBS or local-path (see the local-path-storage ArgoCD application in the <code>argo/local-path-storage</code> directory).</p>
<p>We need to deploy a StorageClass, so that Kubernetes can dynamically provision volumes.</p>
<p>Look at the <code>argo/volumes/dynamic-nfs.yaml</code>:</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">argo/volumes/dynamic-nfs.yaml</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> dynamic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nfs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">topology.kubernetes.io/region</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">topology.kubernetes.io/zone</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sion</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs.csi.k8s.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nfs.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">share</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /srv/nfs/dynamic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mountPermissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;0775&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">mountOptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> hard</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nfsvers=4.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> noatime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> nodiratime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumeBindingMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Immediate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">allowedTopologies</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">matchLabelExpressions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> topology.kubernetes.io/region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">values</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sion</span><br></span></code></pre></div></div>
<p>Change the server address <code>nfs.example.com</code> to your NFS server and apply the resource.</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">f argo/volumes/dynamic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">nfs.yaml</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="3-apps">3. Apps<a href="#3-apps" class="hash-link" aria-label="Direct link to 3. Apps" title="Direct link to 3. Apps" translate="no">​</a></h2>
<p>Since Grendel is using DHCP (and therefore L2 networking), we need to connect Grendel to the network connected to the compute nodes. To do that, we use Multus CNI with IPVLan.</p>
<p>Let&#x27;s start with the ArgoCD application declaration:</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">argo/provisioning/apps/grendel-app.yaml</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> argoproj.io/v1alpha1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grendel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> argocd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">finalizers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> resources</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">finalizer.argocd.argoproj.io</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">project</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> provisioning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">source</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># You should have forked this repo. Change the URL to your fork.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">repoURL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> git@github.com</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&lt;your account</span><span class="token punctuation" style="color:#393A34">&gt;</span><span class="token plain">/ClusterFactory.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># You should use your branch too.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetRevision</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> HEAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> helm/grendel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">helm</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">releaseName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grendel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># We will create a values file inside the fork and change the values.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">valueFiles</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> values</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">production.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">destination</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">server</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;https://kubernetes.default.svc&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> provisioning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">syncPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">automated</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">prune</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Specifies if resources should be pruned during auto-syncing ( false by default ).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">selfHeal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Specifies if partial app sync should be executed when resources are changed only in target Kubernetes cluster and no git change detected ( false by default ).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">allowEmpty</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Allows deleting all application resources during automatic syncing ( false by default ).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">syncOptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">retry</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">limit</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># number of failed sync attempt retries; unlimited number of attempts if less than 0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">backoff</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">duration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 5s </span><span class="token comment" style="color:#999988;font-style:italic"># the amount to back off. Default unit is seconds, but could also be a duration (e.g. &quot;2m&quot;, &quot;1h&quot;)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">factor</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># a factor to multiply the base duration after each failed retry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">maxDuration</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 3m </span><span class="token comment" style="color:#999988;font-style:italic"># the maximum amount of time allowed for the backoff strategy</span><br></span></code></pre></div></div>
<p>Most of the options don&#x27;t need to change, so just add <code>values-production.yaml</code> to the <code>valueFiles</code> field because we will create a <code>values-production.yaml</code>.</p>
<p>If you&#x27;ve looked inside the <code>helm/grendel/</code> directory, you can see the default <code>values.yaml</code>. To change these values, add the <code>values-production.yaml</code> file directly inside the helm application.</p>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="4-values-configuration">4. Values configuration<a href="#4-values-configuration" class="hash-link" aria-label="Direct link to 4. Values configuration" title="Direct link to 4. Values configuration" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_RDz4" id="sticking-the-grendel-pod-to-the-right-zone">Sticking the Grendel Pod to the right zone<a href="#sticking-the-grendel-pod-to-the-right-zone" class="hash-link" aria-label="Direct link to Sticking the Grendel Pod to the right zone" title="Direct link to Sticking the Grendel Pod to the right zone" translate="no">​</a></h3>
<p>After adding the <code>values-production.yaml</code> file in the helm application directory. We can start by selecting where Grendel will be hosted:</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">helm/grendel/values-production.yaml</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">nodeSelector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">kubernetes.io/hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> k0s</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">1.example.com</span><br></span></code></pre></div></div>
<p>Since we are using IPVLAN, the pod needs to be stuck on a Kubernetes node with a known network interface.</p>
<h3 class="anchor anchorTargetStickyNavbar_RDz4" id="grendel-configuration-secret">Grendel Configuration Secret<a href="#grendel-configuration-secret" class="hash-link" aria-label="Direct link to Grendel Configuration Secret" title="Direct link to Grendel Configuration Secret" translate="no">​</a></h3>
<p>Grendel needs a configuration file which contains credentials. Therefore, you need to create a secret with the <code>grendel.toml</code> inside. Create a <code>grendel-secret.yaml.local</code> with the following content:</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">argo/provisioning/secrets/grendel-secret.yaml.local</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grendel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> provisioning</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Opaque</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">stringData</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">grendel.toml</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    dbpath = &quot;:memory:&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    loggers = {cli=&quot;on&quot;, tftp=&quot;on&quot;, dhcp=&quot;on&quot;, dns=&quot;off&quot;, provision=&quot;on&quot;, api=&quot;on&quot;, pxe=&quot;on&quot;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    admin_ssh_pubkeys = []</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">provision</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen = &quot;0.0.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">80&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    token_ttl = 3600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    root_password = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default_image = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    repo_dir = &quot;/var/lib/grendel&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">dhcp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen = &quot;0.0.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">67&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lease_time = &quot;24h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dns_servers = </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    domain_search = </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mtu = 1500</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    proxy_only = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    router_octet4 = 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    subnets = </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">gateway = &quot;192.168.0.1/24&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> dns=&quot;192.168.0.100&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> domainSearch=&quot;example.com&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> mtu=&quot;1500&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">dns</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen = &quot;0.0.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">53&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ttl = 86400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">tftp</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen = &quot;0.0.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">69&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">pxe</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    listen = &quot;0.0.0.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">4011&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">api</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    socket_path = &quot;/var/run/grendel/grendel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">api.socket&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">client</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    api_endpoint = &quot;/var/run/grendel/grendel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">api.socket&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    insecure = false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">bmc</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user = &quot;admin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password = &quot;password&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">discovery</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    password = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    domain = &quot;&quot;</span><br></span></code></pre></div></div>
<p><strong>You need to change the <code>dhcp.subnets</code> configuration according to your network configuration.</strong></p>
<p>Seal the secret and apply it:</p>
<div class="language-shell codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">user@local:/ClusterFactory</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-shell codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token plain">cfctl kubeseal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> argo/provisioning/secrets/grendel-sealed-secret.yaml</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_RDz4" id="nodes-configuration">Nodes configuration<a href="#nodes-configuration" class="hash-link" aria-label="Direct link to Nodes configuration" title="Direct link to Nodes configuration" translate="no">​</a></h3>
<p>After adding the <code>values-production.yaml</code> file in the helm application directory. We can start by adding the provisioning configuration:</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">helm/grendel/values-production.yaml</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">## Secret containing grendel.toml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secretName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grendel</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">secretKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grendel.toml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> cn1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">provision</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">boot_image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> squareos</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">interfaces</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.10.2.51/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mac</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> aa</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">bb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">cc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token datetime number" style="color:#36acaa">11:22:33</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">bmc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">ip</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.10.3.51/32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">bmc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">images</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> squareos</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">9.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">kernel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/var/lib/grendel/vmlinuz-5.14.0-284.30.1.el9_2.x86_64&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">initrd</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/var/lib/grendel/initramfs-5.14.0-284.30.1.el9_2.x86_64.img&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">liveimg</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/var/lib/grendel/squareos-9.2.squashfs&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cmdline</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> console=ttyS0 console=tty0 root=live</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//sos</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">ch</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dk</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">2.exo.io/osimages/squareos</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9.2/squareos</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">9.2.squashfs BOOTIF=01</span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> $.nic.MAC </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> toString </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> replace &quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">&quot; &quot;</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">&quot; </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> grendel.hostname=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> $.host.Name </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> grendel.address=http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//grendel.example.com rd.live.overlay.readonly=1 rd.live.overlay.overlayfs=1 rd.neednet=1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">postscript</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    #!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    touch /hello-world</span><br></span></code></pre></div></div>
<p>The MAC address corresponds to the network interface connected to the network with Grendel.</p>
<p>Inside the image configuration, you can notice some kernel parameters:</p>
<ul>
<li class=""><code>console=ttyS0 console=tty0</code> means that the kernel messages will appear on both the first serial port and virtual terminal.</li>
<li class=""><code>root=live:http://sos-ch-dk-2.exo.io/osimages/squareos-9.2/squareos-9.2.squashfs</code> means that Dracut will load the OS image as a live OS image. <strong>Modify the URL based on the domain name you want to use.</strong></li>
<li class=""><code>rd.live.overlay.readonly=1 rd.live.overlay.overlayfs=1 rd.neednet=1</code> are parameters relative to loading the live OS image. Here, we are mounting the OS image as a read-only base image for the OverlayFS. This is to create a stateless file system.</li>
<li class=""><code>grendel.hostname={{ $.host.Name }} grendel.address=http://grendel.example.com</code> are parameters used to change the hostname of the OS and fetch the postscript. <strong>Modify the URL based on the domain name you want to use.</strong></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_RDz4" id="persistence">Persistence<a href="#persistence" class="hash-link" aria-label="Direct link to Persistence" title="Direct link to Persistence" translate="no">​</a></h3>
<p>Remember the <code>dynamic-nfs</code> storage class we&#x27;ve just created? Let&#x27;s use it now:</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">helm/grendel/values-production.yaml</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">persistence</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;provisioning-nfs&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;ReadWriteMany&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selectorLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grendel</span><br></span></code></pre></div></div>
<p>This will create a PersistentStorageClaim asking for 20Gi to the NFS provisioner. The NFS provisioner will create a directory inside the NFS with the following path <code>/srv/nfs/dynamic/pvc-&lt;UUID&gt;</code>. The UUID in randomized.</p>
<h3 class="anchor anchorTargetStickyNavbar_RDz4" id="ipvlan-configuration">IPVLAN configuration<a href="#ipvlan-configuration" class="hash-link" aria-label="Direct link to IPVLAN configuration" title="Direct link to IPVLAN configuration" translate="no">​</a></h3>
<p>To expose Grendel to the external network, instead of using <code>LoadBalancers</code>, we use <a href="https://github.com/k8snetworkplumbingwg/multus-cni" target="_blank" rel="noopener noreferrer" class="">Multus</a>. Generally, Multus is a CNI plugin to attach multiple network interfaces on Pods. However, we will use Multus CNI to replace the default network interface with an IPVLAN interface.</p>
<p>IPVLAN allows us to directly expose the pod to the host network by assigning an IP to the pod. To do that, you must specify the network interface of the node with the <code>masterInterface</code> field. Then, you should allocate an address using the <code>ipam</code> field.</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">helm/grendel/values-production.yaml</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">net</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Kubernetes host interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">masterInterface</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> l2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ipvlan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># https://www.cni.dev/plugins/current/ipam/static/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ipam</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">addresses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 192.168.0.3/24</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">gateway</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.10.2.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">routes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">dst</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 0.0.0.0/0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-dns-config</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">dns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">nameservers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 1.1.1.1</span><br></span></code></pre></div></div>
<p>More details on IPAM <a href="https://www.cni.dev/plugins/current/ipam/static/" target="_blank" rel="noopener noreferrer" class="">here</a> and for IPVLAN <a href="https://www.cni.dev/plugins/current/main/ipvlan/" target="_blank" rel="noopener noreferrer" class="">here</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_RDz4" id="optional-ipmi-api-configuration">(Optional) IPMI API configuration<a href="#optional-ipmi-api-configuration" class="hash-link" aria-label="Direct link to (Optional) IPMI API configuration" title="Direct link to (Optional) IPMI API configuration" translate="no">​</a></h3>
<p>The helm application can also deploy an IPMI API. This API doesn&#x27;t use L2, so we can expose that service through Traefik by using an Ingress:</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">helm/grendel/values-production.yaml</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">ipmi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">enabled</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ingressClass</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;traefik&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">annotations</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cert-manager.io/cluster-issuer</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> private</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">cluster</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">issuer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">traefik.ingress.kubernetes.io/router.entrypoints</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> websecure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">traefik.ingress.kubernetes.io/router.tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ipmi.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">tls</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">secretName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ipmi.example.com</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">secret</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ipmi.example.com</span><br></span></code></pre></div></div>
<p>With this, you can use <code>cfctl</code> to control your nodes.</p>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="5-coredns-configuration">5. CoreDNS configuration<a href="#5-coredns-configuration" class="hash-link" aria-label="Direct link to 5. CoreDNS configuration" title="Direct link to 5. CoreDNS configuration" translate="no">​</a></h2>
<p>Remember to add a DNS entry each time you want to expose an application:</p>
<div class="language-yaml codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">core/coredns/overlays/prod/configmap.yaml</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-yaml codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">example.com.db</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    # ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    192.168.0.3 grendel.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">    192.168.1.100 ipmi.example.com</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="6-commit-push-deploy">6. Commit, Push, Deploy<a href="#6-commit-push-deploy" class="hash-link" aria-label="Direct link to 6. Commit, Push, Deploy" title="Direct link to 6. Commit, Push, Deploy" translate="no">​</a></h2>
<p>Commit and push:</p>
<div class="language-shell codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-shell codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Added Grendel application and values&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> push</span><br></span></code></pre></div></div>
<p>Deploy the app:</p>
<div class="language-shell codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">user@local:/ClusterFactory</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-shell codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply </span><span class="token parameter variable" style="color:#36acaa">-f</span><span class="token plain"> argo/provisioning/apps/grendel-app.yaml</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="7-optional-building-the-os-image">7. (Optional) Building the OS Image<a href="#7-optional-building-the-os-image" class="hash-link" aria-label="Direct link to 7. (Optional) Building the OS Image" title="Direct link to 7. (Optional) Building the OS Image" translate="no">​</a></h2>
<p>This step is optional, you can download a pre-built SquareOS image:</p>
<ul>
<li class=""><a href="https://sos-ch-dk-2.exo.io/osimages/squareos-9.2/initramfs-4.18.0-372.19.1.el8_6.x86_64.img" target="_blank" rel="noopener noreferrer" class="">initramfs</a></li>
<li class=""><a href="https://sos-ch-dk-2.exo.io/osimages/squareos-9.2/squareos-9.2.squashfs" target="_blank" rel="noopener noreferrer" class="">OS image</a></li>
<li class=""><a href="https://sos-ch-dk-2.exo.io/osimages/squareos-9.2/vmlinuz-4.18.0-372.19.1.el8_6.x86_64" target="_blank" rel="noopener noreferrer" class="">linux kernel</a></li>
</ul>
<p>If you want to build it yourself, we use Packer to build the OS image. To build the OS image:</p>
<ul>
<li class="">
<ol>
<li class="">Install Packer and QEMU.</li>
</ol>
</li>
<li class="">
<ol start="2">
<li class="">Go to the <code>packer-recipes/rocky9.2</code>.</li>
</ol>
</li>
<li class="">
<ol start="3">
<li class="">Build the OS image using the <code>build.bare.sh</code> script.</li>
</ol>
</li>
<li class="">
<ol start="4">
<li class="">Extract the kernel, initramfs and create the squashfs file using the <code>export.bare.sh</code> script.</li>
</ol>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="8-adding-the-os-image-to-grendel">8. Adding the OS Image to Grendel<a href="#8-adding-the-os-image-to-grendel" class="hash-link" aria-label="Direct link to 8. Adding the OS Image to Grendel" title="Direct link to 8. Adding the OS Image to Grendel" translate="no">​</a></h2>
<p>After deploying Grendel, a file server is exposed for you to copy the OS images.</p>
<p>You can access using this URL: <a href="http://grendel.example.com:8080" target="_blank" rel="noopener noreferrer" class="">http://grendel.example.com:8080</a></p>
<p>Drag &amp; Drop the OS image, linux kernel and initramfs there.</p>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="9-bios-configuration">9. BIOS configuration<a href="#9-bios-configuration" class="hash-link" aria-label="Direct link to 9. BIOS configuration" title="Direct link to 9. BIOS configuration" translate="no">​</a></h2>
<p>Make sure your nodes are configured with network boot as the first boot option. Grendel supports:</p>
<ul>
<li class="">x86 Legacy</li>
<li class="">x86 UEFI</li>
<li class="">x86_64 UEFI</li>
<li class="">ARM64 UEFI</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="10-ipmi-commands-rebooting-and-provision">10. IPMI commands, rebooting and provision<a href="#10-ipmi-commands-rebooting-and-provision" class="hash-link" aria-label="Direct link to 10. IPMI commands, rebooting and provision" title="Direct link to 10. IPMI commands, rebooting and provision" translate="no">​</a></h2>
<p>If you&#x27;ve deployed the IPMI API, you can run:</p>
<div class="language-shell codeBlockContainer_DOIF theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_JaEM">user@local:/ClusterFactory</div><div class="codeBlockContent_fO46"><pre tabindex="0" class="prism-code language-shell codeBlock_QGo5 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qEdg"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">IPMIUSER</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">user</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">IPMIPASS</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">password</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">IPMIADDRESS</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">https://ipmi.example.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cfctl ipmi </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">nodename</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">on/off/cycle/status/soft/reset</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>Reboot the nodes with <code>cfctl ipmi cn1 reset</code>.</p>
<p>Read the logs of Grendel and the serial console of your node to see if the boot is successful.</p>
<h2 class="anchor anchorTargetStickyNavbar_RDz4" id="congratulation">Congratulation!<a href="#congratulation" class="hash-link" aria-label="Direct link to Congratulation!" title="Direct link to Congratulation!" translate="no">​</a></h2>
<p>You&#x27;ve finished the guide. However, there is still a lot of application we didn&#x27;t deploy. Continue on these guides if you are interested:</p>
<ul>
<li class=""><a class="" href="/docs/guides/slurm/deploy-slurm">Deploy SLURM, the bare-metal batch scheduler</a></li>
<li class=""><a class="" href="/docs/guides/provisioning/gitops-with-grendel">Configure the postscript to follow the GitOps practices</a></li>
<li class=""><a class="" href="/docs/guides/maintenance/high-availability">About maintenance</a></li>
<li class=""><a href="https://docs.deepsquare.run/deepsquare-grid/clusterfactory/overview" target="_blank" rel="noopener noreferrer" class="">Join the DeepSquare Grid</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_UgHG"><a href="https://github.com/deepsquare-io/ClusterFactory/tree/main/web/docs/getting-started/06-grendel-deployment.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_OL1q" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_tKRN"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/getting-started/adding-repository-argocd"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">5. Adding the Git repository to ArgoCD</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/main-concepts/k0s"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">K0s, the Kubernetes distribution for bare-metal</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_DRA5 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-namespace-and-appproject" class="table-of-contents__link toc-highlight">1. Namespace and AppProject</a></li><li><a href="#2-preparing-the-dynamic-provisioning-of-volumes" class="table-of-contents__link toc-highlight">2. Preparing the dynamic provisioning of volumes</a></li><li><a href="#3-apps" class="table-of-contents__link toc-highlight">3. Apps</a></li><li><a href="#4-values-configuration" class="table-of-contents__link toc-highlight">4. Values configuration</a><ul><li><a href="#sticking-the-grendel-pod-to-the-right-zone" class="table-of-contents__link toc-highlight">Sticking the Grendel Pod to the right zone</a></li><li><a href="#grendel-configuration-secret" class="table-of-contents__link toc-highlight">Grendel Configuration Secret</a></li><li><a href="#nodes-configuration" class="table-of-contents__link toc-highlight">Nodes configuration</a></li><li><a href="#persistence" class="table-of-contents__link toc-highlight">Persistence</a></li><li><a href="#ipvlan-configuration" class="table-of-contents__link toc-highlight">IPVLAN configuration</a></li><li><a href="#optional-ipmi-api-configuration" class="table-of-contents__link toc-highlight">(Optional) IPMI API configuration</a></li></ul></li><li><a href="#5-coredns-configuration" class="table-of-contents__link toc-highlight">5. CoreDNS configuration</a></li><li><a href="#6-commit-push-deploy" class="table-of-contents__link toc-highlight">6. Commit, Push, Deploy</a></li><li><a href="#7-optional-building-the-os-image" class="table-of-contents__link toc-highlight">7. (Optional) Building the OS Image</a></li><li><a href="#8-adding-the-os-image-to-grendel" class="table-of-contents__link toc-highlight">8. Adding the OS Image to Grendel</a></li><li><a href="#9-bios-configuration" class="table-of-contents__link toc-highlight">9. BIOS configuration</a></li><li><a href="#10-ipmi-commands-rebooting-and-provision" class="table-of-contents__link toc-highlight">10. IPMI commands, rebooting and provision</a></li><li><a href="#congratulation" class="table-of-contents__link toc-highlight">Congratulation!</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://deepsquare.io" rel="noopener noreferrer" class="footerLogoLink_ZjBj"><img src="/img/deepsquare-logo-h.svg" alt="Empowers DeepSquare" class="footer__logo themedComponent_mogz themedComponent--light_jBMB"><img src="/img/deepsquare-logo-h-neg.svg" alt="Empowers DeepSquare" class="footer__logo themedComponent_mogz themedComponent--dark_puEI"></a></div><div class="footer__copyright"><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> © 2026 ClusterFactory Docs, <a href="https://squarefactory.io">SquareFactory</a>. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>